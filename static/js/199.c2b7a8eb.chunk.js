(()=>{"use strict";let e=function(e){return e[e.Unknown=0]="Unknown",e[e.NotAvailable=1]="NotAvailable",e[e.Actual=2]="Actual",e}({});const t=[{headerFields:["date","time","usage not yet billed","usage already billed"],mapping:{date:e=>n(e[0]),time:e=>r(e[1]),kWhIn:e=>a(e[2])+a(e[3]),kWhOut:e=>parseFloat(e[4])}},{headerFields:["date","time","off peak","peak","super offpeak"],mapping:{date:e=>n(e[0]),time:e=>r(e[1]),kWhIn:e=>a(e[2])+a(e[3])+a(e[4]),kWhOut:e=>0}},{headerFields:["date","time","off peak(am)","super off peak","peak","off-peak"],mapping:{date:e=>n(e[0]),time:e=>r(e[1]),kWhIn:e=>a(e[2])+a(e[3])+a(e[4])+a(e[5]),kWhOut:e=>0}},{headerFields:["date","time","kwh","kw","kva","power factor"],mapping:{date:e=>n(e[0]),time:e=>r(e[1]),kWhIn:e=>a(e[2]),kWhOut:e=>0}}];function n(e){const t=e.split("/"),n=new Date;return n.setFullYear(parseInt(t[2],10),parseInt(t[1],10)-1,parseInt(t[0],10)),n.setHours(0,0,1,0),n}function r(e){const t=e.split(":");let n=parseInt(t[0],10);return"30"===t[1]&&(n+=.5),n}function a(e){const t=parseFloat(e);return Number.isFinite(t)?t:0}function s(e,t){let n=-1,r=-1;if(t.length<e.length)return[!1,n,r];for(let a=0;a<t.length;a++){const s=t[a].toLowerCase();if("generation"!==s){if(a<e.length&&s!==e[a])return[!1,n,r];r=a}else n=a}return[!0,n,r]}const l=10,o=13,i=100,u=new TextDecoder,c=[new class{constructor(){this.currentFileType=null,this.generationIndex=-1,this.statusIndex=-1}reset(){this.currentFileType=null,this.generationIndex=-1}headerFound(e){for(const n of t){const[t,r,a]=s(n.headerFields,e);if(t)return this.currentFileType=n,this.generationIndex=r,this.statusIndex=a,!0}return!1}processLine(t){if(null==this.currentFileType)return null;const n=this.currentFileType.mapping,r=-1===this.generationIndex?0:a(t[this.generationIndex]),s=-1===this.statusIndex?e.Unknown:"actual"===t[this.statusIndex].toLowerCase()?e.Actual:e.Unknown;return{date:n.date(t),time:n.time(t),kWhIn:n.kWhIn(t),kWhOut:r,readingStatus:s}}}],d={busy:!1,currentFile:null};let p=function(e){return e[e.Unknown=0]="Unknown",e[e.ImportStart=1]="ImportStart",e[e.ImportEnd=2]="ImportEnd",e[e.NewRecords=3]="NewRecords",e[e.Error=4]="Error",e}({});function h(e,t){return{type:p.NewRecords,records:e,recordNumber:t}}function f(e){self.postMessage(e)}function g(e){var t;d.busy?f((t="Currently Busy",{type:p.Error,error:t})):(f({type:p.ImportStart}),d.busy=!0,d.currentFile=e.name,async function(e){const t=Array(0);let n=0,r=null,a=null,s=null,d=!0;for(;d;){let p=await e.read();if(p.done&&(d=!1),void 0===p.value)continue;const g=p.value;let k=0,m=0,y=!1;if(0!==g.length){for(;m<=g.length;){switch(g[m]){case o:y=!0;break;case l:let e;null!=r?(e=new Uint8Array(r.length+(y?m-1:m-k)),e.set(r,0),e.set(g.subarray(k,y?m-1:m),r.length),r=null):e=g.subarray(k,y?m-1:m),k<m&&(a=u.decode(e)),k=m+1,y=!1}if(m++,null==a)continue;a=a.replaceAll('"',""),a=a.toLowerCase();const e=a.split(",");if(a=null,null==s)for(const t of c)t.headerFound(e)&&(s=t);else{const n=s.processLine(e);null!=n&&t.push(n)}}k<m&&(r=g.subarray(k,m)),t.length<i||(f(h(t,n)),n+=t.length,t.splice(0))}}0!==t.length&&f(h(t,n))}(e.stream().getReader()).finally((()=>{d.busy=!1,f({type:p.ImportEnd}),d.currentFile=null})))}self.onmessage=e=>{"function"===typeof e.data.stream&&g(e.data)}})();
//# sourceMappingURL=199.c2b7a8eb.chunk.js.map