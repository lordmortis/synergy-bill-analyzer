(()=>{"use strict";const t=10,e=13;let n=function(t){return t[t.unknown=0]="unknown",t[t.actual=1]="actual",t}({});const r={busy:!1,currentFile:null};let l=function(t){return t[t.Unknown=0]="Unknown",t[t.ImportStart=1]="ImportStart",t[t.ImportEnd=2]="ImportEnd",t[t.NewRecords=3]="NewRecords",t[t.Error=4]="Error",t}({});function a(t,e){return{type:l.NewRecords,records:t,recordNumber:e}}function s(t){self.postMessage(t)}function u(t){const e=t.split("/"),n=new Date;return n.setFullYear(parseInt(e[2],10),parseInt(e[1],10)-1,parseInt(e[0],10)),n.setHours(0,0,1,0),n}function o(t){const e=t.split(":");let n=parseInt(e[0],10);return"30"===e[1]&&(n+=.5),n}function c(t){return"actual"===t.toLowerCase()?n.actual:n.unknown}function i(t,e){const n=(t=t.replaceAll('"',"")).split(",");if(e){let t=0;for(let e=2;e<n.length-1;e++)n[e].length>0&&(t+=parseFloat(n[e]));return{date:u(n[0]),time:o(n[1]),kWh:t,readingStatus:c(n[n.length-1])}}return{date:u(n[0]),time:o(n[1]),kWh:parseFloat(n[2]),readingStatus:c(n[6])}}function f(n){var u;r.busy?s((u="Currently Busy",{type:l.Error,error:u})):(s({type:l.ImportStart}),r.busy=!0,r.currentFile=n.name,async function(n){const r=new TextDecoder;let l=!0,u=null,o=null,c=0,f=0,p=!1;const d=Array(0);let y=!0;for(;y;){let h=await n.read();if(h.done&&(y=!1),void 0===h.value)continue;const g=h.value;let m=0,w=0,I=!1;if(0!==g.length){for(;w<=g.length;){if(g[w]===e)I=!0;else if(g[w]===t){let t;null!=o?(t=new Uint8Array(o.length+(I?w-1:w-m)),t.set(o,0),t.set(g.subarray(m,I?w-1:w),o.length),o=null):t=g.subarray(m,I?w-1:w),m<w&&(u=r.decode(t)),m=w+1,I=!1}w++,null!=u&&(l?(u.startsWith("Date,Time")&&(l=!1),u.startsWith('"Date","Time"')&&(l=!1),p=-1===u.indexOf("kWh")):(d.push(i(u,p)),f++,d.length>=100&&(s(a(d,c)),c=f,d.splice(0,d.length))),u=null)}m<w&&(o=g.subarray(m,w))}}d.length>0&&s(a(d,c))}(n.stream().getReader()).finally((()=>{r.busy=!1,s({type:l.ImportEnd}),r.currentFile=null})))}self.onmessage=t=>{"function"===typeof t.data.stream&&f(t.data)}})();
//# sourceMappingURL=156.487182a6.chunk.js.map