(()=>{"use strict";const t=10,e=13;let n=function(t){return t[t.unknown=0]="unknown",t[t.actual=1]="actual",t}({});const r={busy:!1,currentFile:null};let a=function(t){return t[t.Unknown=0]="Unknown",t[t.ImportStart=1]="ImportStart",t[t.ImportEnd=2]="ImportEnd",t[t.NewRecords=3]="NewRecords",t[t.Error=4]="Error",t}({});function o(t,e){return{type:a.NewRecords,records:t,recordNumber:e}}function s(t){self.postMessage(t)}function l(t){const e=t.split("/"),n=new Date;return n.setFullYear(parseInt(e[2],10),parseInt(e[1],10)-1,parseInt(e[0],10)),n.setHours(0,0,1,0),n}function u(t){const e=t.split(":");let n=parseInt(e[0],10);return"30"===e[1]&&(n+=.5),n}function c(t){const e=t.split(",");return{date:l(e[0]),time:u(e[1]),kWh:parseFloat(e[2]),kW:parseFloat(e[3]),kVA:parseFloat(e[4]),powerFactor:parseFloat(e[5]),readingStatus:(r=e[6],"actual"===r.toLowerCase()?n.actual:n.unknown)};var r}function i(n){var l;r.busy?s((l="Currently Busy",{type:a.Error,error:l})):(s({type:a.ImportStart}),r.busy=!0,r.currentFile=n.name,async function(n){const r=new TextDecoder;let a=!0,l=null,u=null,i=0,p=0;const f=Array(0);for await(const y of n){let n=0,d=0,w=!1;if(0!==y.length){for(;d<=y.length;){if(y[d]===e)w=!0;else if(y[d]===t){let t;null!=u?(t=new Uint8Array(u.length+(w?d-1:d-n)),t.set(u,0),t.set(y.subarray(n,w?d-1:d),u.length),u=null):t=y.subarray(n,w?d-1:d),n<d&&(l=r.decode(t)),n=d+1,w=!1}d++,null!=l&&(a?l.startsWith("Date,Time,kWh")&&(a=!1):(f.push(c(l)),p++,f.length>=100&&(s(o(f,i)),i=p,f.splice(0,f.length))),l=null)}n<d&&(u=y.subarray(n,d))}}f.length>0&&s(o(f,i))}(n.stream()).finally((()=>{r.busy=!1,s({type:a.ImportEnd}),r.currentFile=null})))}self.onmessage=t=>{"function"===typeof t.data.stream&&i(t.data)}})();
//# sourceMappingURL=156.f330f06c.chunk.js.map